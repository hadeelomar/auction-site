import{d as pe,u as _e,a as me,b as fe,r as u,c as y,o as ye,e as ge,f as a,g as l,h as ie,i as e,N as we,j as m,k as F,t as s,l as o,n as R,m as be,w as ne,p as O,v as L,F as U,q as H,s as ke,x as xe,y as Be,z as Ce,_ as qe}from"./index-zRjMQsdE.js";const Se={class:"page-wrapper"},$e={class:"main-content"},Te={class:"page-container"},Me={key:0,class:"loading-state"},Ae={key:1,class:"error-state"},Pe={key:2,class:"auction-detail"},Ie={class:"auction-grid"},je={class:"auction-image-section"},Fe={class:"auction-image-container"},Ne=["src","alt"],De={key:1,class:"no-image"},Qe={class:"auction-info-section"},Ve={class:"auction-header"},Re={class:"auction-title"},Oe={class:"auction-description"},Le={class:"price-section"},Ue={class:"price-item"},He={class:"price-label"},Ee={class:"price-value"},ze={class:"price-item current"},Je={class:"price-label"},Ge={class:"price-value highlight"},Ke={class:"auction-meta"},We={class:"meta-item"},Xe={class:"meta-label"},Ye={class:"meta-value"},Ze={class:"meta-item"},et={class:"meta-label"},tt={class:"meta-value"},st={class:"meta-item"},it={class:"meta-label"},nt={class:"meta-value"},ot={class:"bidding-section"},at={key:1,class:"bid-disabled"},lt={key:2,class:"bid-disabled"},rt={key:3,class:"bid-disabled winning"},ct={class:"bid-input-group"},ut={class:"currency-symbol"},dt=["min","placeholder","disabled"],vt=["disabled"],ht={key:0},pt={key:1},_t={key:5,class:"bid-hint"},mt={key:0,class:"bid-history"},ft={class:"bid-list"},yt={class:"bid-info"},gt={class:"bidder-name"},wt={class:"bid-time"},bt={class:"bid-amount"},kt={class:"qa-section"},xt={key:0,class:"ask-question-form"},Bt=["placeholder","disabled"],Ct=["disabled"],qt={key:0},St={key:1},$t={key:1,class:"login-prompt"},Tt={key:2,class:"qa-loading"},Mt={key:3,class:"questions-list"},At={class:"question-header"},Pt={class:"question-author"},It={class:"question-time"},jt={class:"question-text"},Ft={key:0,class:"replies-list"},Nt={class:"reply-header"},Dt={class:"reply-author"},Qt={class:"reply-time"},Vt={class:"reply-text"},Rt={key:1,class:"reply-form-container"},Ot=["onClick"],Lt={key:1,class:"reply-form"},Ut=["placeholder","disabled"],Ht={class:"reply-form-actions"},Et=["onClick","disabled"],zt={key:0},Jt={key:1},Gt={key:4,class:"no-questions"},Kt={class:"footer"},Wt={class:"footer-content"},g="http://localhost:8000/api",Xt=pe({__name:"AuctionDetailPage",setup(Yt){const{t:r}=_e(),E=me(),oe=Ce(),ae=Be(),N=fe(),i=u(null),T=u(!0),h=u(null),w=u([]),p=u(null),b=u(!1),k=u(null),z=u("success");let M=null;const x=u([]),D=u(!1),f=u(""),B=u(!1),C=u(null),J=u("success"),A=u(null),_=u(""),q=u(!1),le=y(()=>{if(!i.value?.owner)return"Unknown";const{first_name:n,last_name:t,email:v}=i.value.owner;return n||t?`${n} ${t}`.trim():v}),P=y(()=>N.user?.id??null),G=y(()=>!i.value||!P.value?!1:i.value.owner.id===P.value),K=y(()=>!P.value||w.value.length===0?!1:w.value[0].user.id===P.value),W=y(()=>i.value?parseFloat(i.value.current_price)+.01:0),X=y(()=>!p.value||!i.value?!1:p.value>parseFloat(i.value.current_price));function S(n){return E.formatPrice(parseFloat(n))}function Y(n){return new Date(n).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}function Q(n){const t=new Date(n),c=new Date().getTime()-t.getTime(),d=Math.floor(c/1e3),I=Math.floor(d/60),j=Math.floor(I/60),se=Math.floor(j/24);return d<60?"just now":I<60?`${I} minute${I>1?"s":""} ago`:j<24?`${j} hour${j>1?"s":""} ago`:`${se} day${se>1?"s":""} ago`}function re(){ae.push({name:"home"})}function V(n,t){k.value=n,z.value=t,setTimeout(()=>{k.value=null},5e3)}async function Z(){const n=oe.params.id;if(!n){h.value="No auction ID provided",T.value=!1;return}T.value=!0,h.value=null;try{const t=await fetch(`${g}/auctions/${n}/`,{credentials:"include"});if(!t.ok){t.status===404?h.value="Auction not found":h.value="Failed to load auction details";return}const v=await t.json();i.value=v.item,await ee()}catch(t){h.value="Could not connect to the server",console.error(t)}finally{T.value=!1}}async function ee(){if(i.value)try{const n=await fetch(`${g}/auctions/${i.value.id}/`,{credentials:"include"});if(n.ok){const t=await n.json(),v=t.item.current_price;i.value&&v!==i.value.current_price&&(i.value.current_price=v,i.value.is_active=t.item.is_active)}}catch(n){console.error("Failed to fetch bids:",n)}}async function ce(){if(!(!i.value||!p.value||!X.value)){b.value=!0,k.value=null;try{const n=await fetch(`${g}/bids/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({item_id:i.value.id,bid_amount:p.value.toFixed(2)})}),t=await n.json();if(!n.ok){V(t.error||"Failed to place bid","error");return}i.value.current_price=t.item.current_price,i.value.is_active=t.item.is_active,w.value.unshift(t.bid),p.value=null,V("Bid placed successfully!","success")}catch(n){V("Could not connect to the server","error"),console.error(n)}finally{b.value=!1}}}function ue(){M=setInterval(async()=>{i.value?.is_active?await ee():te()},7e3)}function te(){M&&(clearInterval(M),M=null)}function $(n,t){C.value=n,J.value=t,setTimeout(()=>{C.value=null},5e3)}async function de(){if(i.value){D.value=!0;try{const n=await fetch(`${g}/questions/?item_id=${i.value.id}`,{credentials:"include"});if(n.ok){const t=await n.json();x.value=t.questions}}catch(n){console.error("Failed to fetch questions:",n)}finally{D.value=!1}}}async function ve(){if(!(!i.value||!f.value.trim())){B.value=!0,C.value=null;try{const n=await fetch(`${g}/questions/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({item_id:i.value.id,question_text:f.value.trim()})}),t=await n.json();if(!n.ok){$(t.error||"Failed to post question","error");return}x.value.unshift(t.question),f.value="",$("Question posted successfully!","success")}catch(n){$("Could not connect to the server","error"),console.error(n)}finally{B.value=!1}}}async function he(n){if(_.value.trim()){q.value=!0;try{const t=await fetch(`${g}/questions/${n}/reply/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reply_text:_.value.trim()})}),v=await t.json();if(!t.ok){$(v.error||"Failed to post reply","error");return}const c=x.value.find(d=>d.id===n);c&&c.replies.push(v.reply),_.value="",A.value=null}catch(t){$("Could not connect to the server","error"),console.error(t)}finally{q.value=!1}}}return ye(async()=>{await Z(),i.value?.is_active&&ue(),await de()}),ge(()=>{te()}),(n,t)=>{const v=xe("router-link");return l(),a("div",Se,[ie(we),e("main",$e,[e("div",Te,[e("button",{class:"back-btn",onClick:re},[t[4]||(t[4]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m15 18-6-6 6-6"})],-1)),F(" "+s(o(r)("detail.backToAuctions")),1)]),T.value?(l(),a("div",Me,[t[5]||(t[5]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,s(o(r)("common.loading")),1)])):h.value?(l(),a("div",Ae,[t[6]||(t[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),e("p",null,s(h.value),1),e("button",{class:"retry-btn",onClick:Z},s(o(r)("detail.tryAgain")),1)])):i.value?(l(),a("div",Pe,[e("div",Ie,[e("div",je,[e("div",Fe,[i.value.image?(l(),a("img",{key:0,src:i.value.image,alt:i.value.title,class:"auction-image"},null,8,Ne)):(l(),a("div",De,[t[7]||(t[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),e("circle",{cx:"9",cy:"9",r:"2"}),e("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})],-1)),e("span",null,s(o(r)("detail.noImage")),1)]))])]),e("div",Qe,[e("div",Ve,[e("h1",Re,s(i.value.title),1),e("span",{class:R(["status-badge",i.value.is_active?"active":"ended"])},s(i.value.is_active?o(r)("auction.active"):o(r)("auction.ended")),3)]),e("p",Oe,s(i.value.description),1),e("div",Le,[e("div",Ue,[e("span",He,s(o(r)("auction.startingPrice")),1),e("span",Ee,s(S(i.value.starting_price)),1)]),e("div",ze,[e("span",Je,s(o(r)("auction.currentPrice")),1),e("span",Ge,s(S(i.value.current_price)),1)])]),e("div",Ke,[e("div",We,[t[8]||(t[8]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),e("span",Xe,s(o(r)("detail.seller")),1),e("span",Ye,s(le.value),1)]),e("div",Ze,[t[9]||(t[9]=be('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-dc10e51e><rect width="18" height="18" x="3" y="4" rx="2" ry="2" data-v-dc10e51e></rect><line x1="16" x2="16" y1="2" y2="6" data-v-dc10e51e></line><line x1="8" x2="8" y1="2" y2="6" data-v-dc10e51e></line><line x1="3" x2="21" y1="10" y2="10" data-v-dc10e51e></line></svg>',1)),e("span",et,s(o(r)("detail.listed")),1),e("span",tt,s(Y(i.value.created_at)),1)]),e("div",st,[t[10]||(t[10]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1)),e("span",it,s(o(r)("detail.ends")),1),e("span",nt,s(Y(i.value.ends_at)),1)])]),e("div",ot,[e("h3",null,s(o(r)("auction.placeBid")),1),k.value?(l(),a("div",{key:0,class:R(["bid-message",z.value])},s(k.value),3)):m("",!0),i.value.is_active?G.value?(l(),a("div",lt,[t[12]||(t[12]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})],-1)),e("span",null,s(o(r)("detail.cannotBidOwn")),1)])):K.value?(l(),a("div",rt,[t[13]||(t[13]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})],-1)),e("span",null,s(o(r)("detail.highestBidder")),1)])):(l(),a("form",{key:4,onSubmit:ne(ce,["prevent"]),class:"bid-form"},[e("div",ct,[e("span",ut,s(o(E).currentCurrencySymbol),1),O(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>p.value=c),type:"number",step:"0.01",min:W.value,placeholder:`Min: ${S(W.value.toString())}`,class:"bid-input",disabled:b.value,required:""},null,8,dt),[[L,p.value]])]),e("button",{type:"submit",class:"bid-btn",disabled:b.value||!X.value},[b.value?(l(),a("span",ht,s(o(r)("detail.placingBid")),1)):(l(),a("span",pt,s(o(r)("auction.placeBid")),1))],8,vt)],32)):(l(),a("div",at,[t[11]||(t[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})],-1)),e("span",null,s(o(r)("detail.auctionEnded")),1)])),i.value.is_active&&!G.value&&!K.value?(l(),a("p",_t," Enter an amount greater than "+s(S(i.value.current_price)),1)):m("",!0)]),w.value.length>0?(l(),a("div",mt,[e("h3",null,s(o(r)("auction.bidHistory")),1),e("div",ft,[(l(!0),a(U,null,H(w.value,c=>(l(),a("div",{key:c.id,class:"bid-item"},[e("div",yt,[e("span",gt,s(c.user.first_name)+" "+s(c.user.last_name),1),e("span",wt,s(Q(c.timestamp)),1)]),e("span",bt,s(S(c.bid_amount)),1)]))),128))])])):m("",!0)])]),e("div",kt,[e("h2",null,s(o(r)("qna.title")),1),o(N).isAuthenticated?(l(),a("div",xt,[C.value?(l(),a("div",{key:0,class:R(["qa-message",J.value])},s(C.value),3)):m("",!0),e("form",{onSubmit:ne(ve,["prevent"])},[O(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>f.value=c),placeholder:o(r)("detail.askPlaceholder"),class:"question-input",disabled:B.value,rows:"3"},null,8,Bt),[[L,f.value]]),e("button",{type:"submit",class:"submit-question-btn",disabled:B.value||!f.value.trim()},[B.value?(l(),a("span",qt,s(o(r)("detail.posting")),1)):(l(),a("span",St,s(o(r)("qna.askQuestion")),1))],8,Ct)],32)])):(l(),a("div",$t,[e("p",null,[F(s(o(r)("qna.signInToAsk").split("sign in")[0]),1),ie(v,{to:"/login"},{default:ke(()=>[F(s(o(r)("common.login").toLowerCase()),1)]),_:1}),F(s(o(r)("qna.signInToAsk").split("sign in")[1]||" to ask a question."),1)])])),D.value?(l(),a("div",Tt,[t[14]||(t[14]=e("div",{class:"loading-spinner-small"},null,-1)),e("span",null,s(o(r)("detail.loadingQuestions")),1)])):x.value.length>0?(l(),a("div",Mt,[(l(!0),a(U,null,H(x.value,c=>(l(),a("div",{key:c.id,class:"question-item"},[e("div",At,[e("span",Pt,s(c.user.first_name)+" "+s(c.user.last_name),1),e("span",It,s(Q(c.timestamp)),1)]),e("p",jt,s(c.question_text),1),c.replies.length>0?(l(),a("div",Ft,[(l(!0),a(U,null,H(c.replies,d=>(l(),a("div",{key:d.id,class:"reply-item"},[e("div",Nt,[e("span",Dt,s(d.user.first_name)+" "+s(d.user.last_name),1),e("span",Qt,s(Q(d.timestamp)),1)]),e("p",Vt,s(d.reply_text),1)]))),128))])):m("",!0),o(N).isAuthenticated?(l(),a("div",Rt,[A.value!==c.id?(l(),a("button",{key:0,onClick:d=>A.value=c.id,class:"reply-toggle-btn"},s(o(r)("qna.reply")),9,Ot)):(l(),a("div",Lt,[O(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=d=>_.value=d),placeholder:o(r)("detail.replyPlaceholder"),class:"reply-input",disabled:q.value,rows:"2"},null,8,Ut),[[L,_.value]]),e("div",Ht,[e("button",{type:"button",onClick:t[3]||(t[3]=d=>{A.value=null,_.value=""}),class:"cancel-reply-btn"},s(o(r)("common.cancel")),1),e("button",{type:"button",onClick:d=>he(c.id),class:"submit-reply-btn",disabled:q.value||!_.value.trim()},[q.value?(l(),a("span",zt,s(o(r)("detail.posting")),1)):(l(),a("span",Jt,s(o(r)("detail.postReply")),1))],8,Et)])]))])):m("",!0)]))),128))])):(l(),a("div",Gt,[t[15]||(t[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1)),e("p",null,s(o(r)("qna.noQuestions")),1)]))])])):m("",!0)])]),e("footer",Kt,[e("div",Wt,[e("p",null,"2026 Bido. "+s(o(r)("footer.allRightsReserved")),1)])])])}}}),es=qe(Xt,[["__scopeId","data-v-dc10e51e"]]);export{es as default};

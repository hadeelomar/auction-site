import{d as z,u as Q,r,p as d,q as Y,s as G,c as n,o as a,f as J,e,N as K,i as b,l as W,t as l,n as I,x as X,h as Z,j as ee,v as te,F as se,y as ie,m as ne,a as ae,_ as oe}from"./index-BVR3-h3M.js";const le={class:"page-wrapper"},re={class:"main-content"},ue={class:"page-container"},ce={key:0,class:"loading-state"},de={key:1,class:"error-state"},ve={key:2,class:"auction-detail"},he={class:"auction-grid"},pe={class:"auction-image-section"},me={class:"auction-image-container"},we=["src","alt"],ge={key:1,class:"no-image"},fe={class:"auction-info-section"},_e={class:"auction-header"},ye={class:"auction-title"},be={class:"auction-description"},xe={class:"price-section"},ke={class:"price-item"},Be={class:"price-value"},Ce={class:"price-item current"},Ae={class:"price-value highlight"},Me={class:"auction-meta"},Se={class:"meta-item"},$e={class:"meta-value"},Pe={class:"meta-item"},De={class:"meta-value"},Ne={class:"meta-item"},Te={class:"meta-value"},Fe={class:"bidding-section"},Ie={key:1,class:"bid-disabled"},Ve={key:2,class:"bid-disabled"},je={key:3,class:"bid-disabled winning"},Le={class:"bid-input-group"},Ee=["min","placeholder","disabled"],He=["disabled"],Ue={key:0},qe={key:1},Re={key:5,class:"bid-hint"},Oe={key:0,class:"bid-history"},ze={class:"bid-list"},Qe={class:"bid-info"},Ye={class:"bidder-name"},Ge={class:"bid-time"},Je={class:"bid-amount"},k="http://localhost:8000/api",Ke=z({__name:"AuctionDetailPage",setup(We){const V=ae(),j=ne(),L=Q(),s=r(null),w=r(!0),u=r(null),v=r([]),c=r(null),h=r(!1),p=r(null),B=r("success");let g=null;const E=d(()=>{if(!s.value?.owner)return"Unknown";const{first_name:i,last_name:t,email:o}=s.value.owner;return i||t?`${i} ${t}`.trim():o}),f=d(()=>L.user?.id??null),C=d(()=>!s.value||!f.value?!1:s.value.owner.id===f.value),A=d(()=>!f.value||v.value.length===0?!1:v.value[0].user.id===f.value),M=d(()=>s.value?parseFloat(s.value.current_price)+.01:0),S=d(()=>!c.value||!s.value?!1:c.value>parseFloat(s.value.current_price));function m(i){return"£"+parseFloat(i).toFixed(2)}function $(i){return new Date(i).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}function H(i){const t=new Date(i),O=new Date().getTime()-t.getTime(),T=Math.floor(O/1e3),_=Math.floor(T/60),y=Math.floor(_/60),F=Math.floor(y/24);return T<60?"just now":_<60?`${_} minute${_>1?"s":""} ago`:y<24?`${y} hour${y>1?"s":""} ago`:`${F} day${F>1?"s":""} ago`}function U(){j.push({name:"home"})}function x(i,t){p.value=i,B.value=t,setTimeout(()=>{p.value=null},5e3)}async function P(){const i=V.params.id;if(!i){u.value="No auction ID provided",w.value=!1;return}w.value=!0,u.value=null;try{const t=await fetch(`${k}/auctions/${i}/`,{credentials:"include"});if(!t.ok){t.status===404?u.value="Auction not found":u.value="Failed to load auction details";return}const o=await t.json();s.value=o.item,await D()}catch(t){u.value="Could not connect to the server",console.error(t)}finally{w.value=!1}}async function D(){if(s.value)try{const i=await fetch(`${k}/auctions/${s.value.id}/`,{credentials:"include"});if(i.ok){const t=await i.json(),o=t.item.current_price;s.value&&o!==s.value.current_price&&(s.value.current_price=o,s.value.is_active=t.item.is_active)}}catch(i){console.error("Failed to fetch bids:",i)}}async function q(){if(!(!s.value||!c.value||!S.value)){h.value=!0,p.value=null;try{const i=await fetch(`${k}/bids/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({item_id:s.value.id,bid_amount:c.value.toFixed(2)})}),t=await i.json();if(!i.ok){x(t.error||"Failed to place bid","error");return}s.value.current_price=t.item.current_price,s.value.is_active=t.item.is_active,v.value.unshift(t.bid),c.value=null,x("Bid placed successfully!","success")}catch(i){x("Could not connect to the server","error"),console.error(i)}finally{h.value=!1}}}function R(){g=setInterval(async()=>{s.value?.is_active?await D():N()},7e3)}function N(){g&&(clearInterval(g),g=null)}return Y(async()=>{await P(),s.value?.is_active&&R()}),G(()=>{N()}),(i,t)=>(a(),n("div",le,[J(K),e("main",re,[e("div",ue,[e("button",{class:"back-btn",onClick:U},[...t[1]||(t[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m15 18-6-6 6-6"})],-1),W(" Back to Auctions ",-1)])]),w.value?(a(),n("div",ce,[...t[2]||(t[2]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading auction details...",-1)])])):u.value?(a(),n("div",de,[t[3]||(t[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),e("p",null,l(u.value),1),e("button",{class:"retry-btn",onClick:P},"Try Again")])):s.value?(a(),n("div",ve,[e("div",he,[e("div",pe,[e("div",me,[s.value.image?(a(),n("img",{key:0,src:s.value.image,alt:s.value.title,class:"auction-image"},null,8,we)):(a(),n("div",ge,[...t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),e("circle",{cx:"9",cy:"9",r:"2"}),e("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})],-1),e("span",null,"No Image Available",-1)])]))])]),e("div",fe,[e("div",_e,[e("h1",ye,l(s.value.title),1),e("span",{class:I(["status-badge",s.value.is_active?"active":"ended"])},l(s.value.is_active?"Active":"Ended"),3)]),e("p",be,l(s.value.description),1),e("div",xe,[e("div",ke,[t[5]||(t[5]=e("span",{class:"price-label"},"Starting Price",-1)),e("span",Be,l(m(s.value.starting_price)),1)]),e("div",Ce,[t[6]||(t[6]=e("span",{class:"price-label"},"Current Price",-1)),e("span",Ae,l(m(s.value.current_price)),1)])]),e("div",Me,[e("div",Se,[t[7]||(t[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),t[8]||(t[8]=e("span",{class:"meta-label"},"Seller:",-1)),e("span",$e,l(E.value),1)]),e("div",Pe,[t[9]||(t[9]=X('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-63622b7f><rect width="18" height="18" x="3" y="4" rx="2" ry="2" data-v-63622b7f></rect><line x1="16" x2="16" y1="2" y2="6" data-v-63622b7f></line><line x1="8" x2="8" y1="2" y2="6" data-v-63622b7f></line><line x1="3" x2="21" y1="10" y2="10" data-v-63622b7f></line></svg><span class="meta-label" data-v-63622b7f>Listed:</span>',2)),e("span",De,l($(s.value.created_at)),1)]),e("div",Ne,[t[10]||(t[10]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1)),t[11]||(t[11]=e("span",{class:"meta-label"},"Ends:",-1)),e("span",Te,l($(s.value.ends_at)),1)])]),e("div",Fe,[t[16]||(t[16]=e("h3",null,"Place a Bid",-1)),p.value?(a(),n("div",{key:0,class:I(["bid-message",B.value])},l(p.value),3)):b("",!0),s.value.is_active?C.value?(a(),n("div",Ve,[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})],-1),e("span",null,"You cannot bid on your own auction",-1)])])):A.value?(a(),n("div",je,[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})],-1),e("span",null,"You are the highest bidder!",-1)])])):(a(),n("form",{key:4,onSubmit:Z(q,["prevent"]),class:"bid-form"},[e("div",Le,[t[15]||(t[15]=e("span",{class:"currency-symbol"},"£",-1)),ee(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),type:"number",step:"0.01",min:M.value,placeholder:`Min: ${m(M.value.toString())}`,class:"bid-input",disabled:h.value,required:""},null,8,Ee),[[te,c.value]])]),e("button",{type:"submit",class:"bid-btn",disabled:h.value||!S.value},[h.value?(a(),n("span",Ue,"Placing Bid...")):(a(),n("span",qe,"Place Bid"))],8,He)],32)):(a(),n("div",Ie,[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})],-1),e("span",null,"This auction has ended",-1)])])),s.value.is_active&&!C.value&&!A.value?(a(),n("p",Re," Enter an amount greater than "+l(m(s.value.current_price)),1)):b("",!0)]),v.value.length>0?(a(),n("div",Oe,[t[17]||(t[17]=e("h3",null,"Bid History",-1)),e("div",ze,[(a(!0),n(se,null,ie(v.value,o=>(a(),n("div",{key:o.id,class:"bid-item"},[e("div",Qe,[e("span",Ye,l(o.user.first_name)+" "+l(o.user.last_name),1),e("span",Ge,l(H(o.timestamp)),1)]),e("span",Je,l(m(o.bid_amount)),1)]))),128))])])):b("",!0)])]),t[18]||(t[18]=e("div",{class:"qa-section"},[e("h2",null,"Questions & Answers"),e("div",{class:"qa-placeholder"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})]),e("p",null,"Q&A section coming soon (Issue #15)")])],-1))])):b("",!0)])])]))}}),Ze=oe(Ke,[["__scopeId","data-v-63622b7f"]]);export{Ze as default};

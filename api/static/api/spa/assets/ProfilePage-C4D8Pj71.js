import{d as Q,u as Y,k as Z,r as w,C as O,o as ee,a as d,b as c,e,m as U,N as se,n as v,t as l,f as i,w as I,g as m,s as g,h as V,v as y,y as te,E as ae,F as oe,_ as re}from"./index-I6Zbi9ll.js";const le={class:"page-wrapper"},ie={class:"main-content"},ne={class:"profile-container"},de={class:"profile-title"},ce={class:"profile-subtitle"},fe={class:"section-title"},pe={class:"avatar-upload-container"},ue=["src"],me={key:1,class:"avatar-placeholder"},he={class:"avatar-info"},we={class:"avatar-label"},ve={class:"avatar-hint"},_e={key:0,class:"error-message"},ge={class:"section-title"},ye={class:"form-grid"},Pe={class:"form-group"},be={for:"firstName",class:"form-label"},ke=["placeholder"],Ne={key:0,class:"error-message"},xe={class:"form-group"},Be={for:"lastName",class:"form-label"},De=["placeholder"],Ce={key:0,class:"error-message"},Oe={class:"form-group"},Fe={for:"email",class:"form-label"},Te={class:"form-group"},Se={for:"dateOfBirth",class:"form-label"},Re={key:0,class:"error-message"},Ue={class:"section-title"},Ie={class:"section-description"},Ve={class:"form-grid"},Ee={class:"form-group"},qe={for:"currentPassword",class:"form-label"},Le=["placeholder"],Ae={key:0,class:"error-message"},Me={class:"form-group"},je={for:"newPassword",class:"form-label"},ze=["placeholder"],$e={key:0,class:"error-message"},He=["disabled"],We={key:0},Xe={key:1},Ge={class:"footer"},Je={class:"footer-content"},Ke={key:0,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Qe={key:1,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ye=Q({__name:"ProfilePage",setup(Ze){const{t:o}=Y(),f=Z(),P=w(null),b=w(!1),k=w(!1),F=w(null),h=w(""),N=w(null),_=w(!1),a=O({firstName:"",lastName:"",email:"",dateOfBirth:"",currentPassword:"",newPassword:""}),r=O({firstName:"",lastName:"",email:"",dateOfBirth:"",image:"",currentPassword:"",newPassword:""}),u=O({show:!1,message:"",type:"success"}),E=()=>P.value?.click(),q=t=>{const s=t.target;s.files&&s.files[0]&&T(s.files[0])},L=t=>{t.preventDefault(),t.stopPropagation(),b.value=!0},A=t=>{t.preventDefault(),t.stopPropagation(),b.value=!1},M=t=>{t.preventDefault(),t.stopPropagation()},j=t=>{t.preventDefault(),t.stopPropagation(),b.value=!1,t.dataTransfer?.files&&t.dataTransfer.files[0]&&T(t.dataTransfer.files[0])},T=t=>{if(r.image="",!t.type.startsWith("image/")){r.image=o("profile.selectImageFile");return}if(t.size>5*1024*1024){r.image=o("profile.fileSizeError");return}F.value=t,z(t)},z=t=>{const s=new FileReader;s.onload=n=>{const p=new Image;p.onload=()=>{const x=document.createElement("canvas"),R=x.getContext("2d");if(!R)return;const B=Math.min(p.width,p.height),J=(p.width-B)/2,K=(p.height-B)/2;x.width=200,x.height=200,R.drawImage(p,J,K,B,B,0,0,200,200),x.toBlob(C=>{C&&(N.value=C,h.value=URL.createObjectURL(C))},"image/jpeg",.9)},p.src=n.target?.result},s.readAsDataURL(t)},$=()=>{h.value="",F.value=null,N.value=null,P.value&&(P.value.value="")},H=()=>{let t=!0;return r.firstName="",r.lastName="",r.email="",r.dateOfBirth="",r.currentPassword="",r.newPassword="",a.firstName.trim()||(r.firstName=o("profile.firstNameRequired"),t=!1),a.lastName.trim()||(r.lastName=o("profile.lastNameRequired"),t=!1),/\S+@\S+\.\S+/.test(a.email)||(r.email=o("profile.invalidEmail"),t=!1),a.dateOfBirth&&new Date(a.dateOfBirth)>new Date&&(r.dateOfBirth=o("profile.dateInFuture"),t=!1),(a.currentPassword||a.newPassword)&&(!a.currentPassword||!a.newPassword)&&(a.currentPassword||(r.currentPassword=o("profile.currentPasswordRequired")),a.newPassword||(r.newPassword=o("profile.newPasswordRequired")),t=!1),a.newPassword&&a.newPassword.length<6&&(r.newPassword=o("profile.passwordTooShort"),t=!1),t},W=async()=>{if(H()){k.value=!0;try{await G();const t=X("csrftoken"),s=new FormData;s.append("first_name",a.firstName),s.append("last_name",a.lastName),s.append("email",a.email),a.dateOfBirth&&s.append("date_of_birth",a.dateOfBirth),a.currentPassword&&s.append("current_password",a.currentPassword),a.newPassword&&s.append("new_password",a.newPassword),N.value&&s.append("profile_image",N.value,"profile.jpg");const n=await fetch("http://localhost:8001/api/profile/update/",{method:"POST",headers:{"X-CSRFToken":t||""},credentials:"include",body:s});if(n.ok)await f.checkAuth(),D(o("profile.profileUpdated"),"success"),a.currentPassword="",a.newPassword="";else{const p=await n.json();D(p.error||o("profile.updateFailed"),"error")}}catch{D(o("profile.updateError"),"error")}finally{k.value=!1}}},S=async()=>{await f.checkAuth(),f.user&&(a.firstName=f.user.first_name||"",a.lastName=f.user.last_name||"",a.email=f.user.email||"",a.dateOfBirth=f.user.date_of_birth||"",f.user.profile_image&&(h.value=f.user.profile_image))};function X(t){const n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2&&n.pop()?.split(";").shift()||null}async function G(){try{await fetch("http://localhost:8001/api/auth/csrf/",{credentials:"include"})}catch(t){console.error("Failed to fetch CSRF token:",t)}}function D(t,s="success"){u.message=t,u.type=s,u.show=!0,setTimeout(()=>{u.show=!1},3e3)}return ee(async()=>{await S(),setTimeout(()=>{_.value=!0},50)}),(t,s)=>(c(),d(oe,null,[e("div",le,[U(se),e("main",ie,[e("div",ne,[e("div",{class:v(["profile-header reveal-box",{revealed:_.value}])},[e("h1",de,l(i(o)("profile.title")),1),e("p",ce,l(i(o)("profile.subtitle")),1)],2),e("form",{onSubmit:I(W,["prevent"]),class:"profile-form"},[e("div",{class:v(["form-section reveal-box",{revealed:_.value}]),style:{"animation-delay":"0.1s"}},[e("h2",fe,l(i(o)("profile.profilePicture")),1),e("div",pe,[e("div",{class:v(["avatar-preview",{dragging:b.value}]),onClick:E,onDragenter:L,onDragleave:A,onDragover:M,onDrop:j},[e("input",{ref_key:"fileInput",ref:P,type:"file",accept:"image/*",onChange:q,class:"file-input"},null,544),h.value?(c(),d("img",{key:0,src:h.value,alt:"Profile",class:"avatar-image"},null,8,ue)):(c(),d("div",me,[...s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)])])),h.value?(c(),d("button",{key:2,type:"button",class:"remove-button",onClick:I($,["stop"])},[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])):m("",!0)],34),e("div",he,[e("p",we,l(h.value?i(o)("profile.avatarUploaded"):i(o)("profile.uploadAvatar")),1),e("p",ve,l(i(o)("profile.fileFormatHint")),1)]),r.image?(c(),d("span",_e,l(r.image),1)):m("",!0)])],2),e("div",{class:v(["form-section reveal-box",{revealed:_.value}]),style:{"animation-delay":"0.2s"}},[e("h2",ge,l(i(o)("profile.personalInformation")),1),e("div",ye,[e("div",Pe,[e("label",be,[V(l(i(o)("profile.firstName"))+" ",1),s[8]||(s[8]=e("span",{class:"required"},"*",-1))]),g(e("input",{id:"firstName","onUpdate:modelValue":s[0]||(s[0]=n=>a.firstName=n),type:"text",class:"form-input",placeholder:i(o)("profile.enterFirstName")},null,8,ke),[[y,a.firstName]]),r.firstName?(c(),d("span",Ne,l(r.firstName),1)):m("",!0)]),e("div",xe,[e("label",Be,[V(l(i(o)("profile.lastName"))+" ",1),s[9]||(s[9]=e("span",{class:"required"},"*",-1))]),g(e("input",{id:"lastName","onUpdate:modelValue":s[1]||(s[1]=n=>a.lastName=n),type:"text",class:"form-input",placeholder:i(o)("profile.enterLastName")},null,8,De),[[y,a.lastName]]),r.lastName?(c(),d("span",Ce,l(r.lastName),1)):m("",!0)]),e("div",Oe,[e("label",Fe,l(i(o)("auth.email")),1),g(e("input",{id:"email","onUpdate:modelValue":s[2]||(s[2]=n=>a.email=n),type:"email",class:"form-input",readonly:""},null,512),[[y,a.email]])]),e("div",Te,[e("label",Se,l(i(o)("profile.dateOfBirth")),1),g(e("input",{id:"dateOfBirth","onUpdate:modelValue":s[3]||(s[3]=n=>a.dateOfBirth=n),type:"date",class:"form-input"},null,512),[[y,a.dateOfBirth]]),r.dateOfBirth?(c(),d("span",Re,l(r.dateOfBirth),1)):m("",!0)])])],2),e("div",{class:v(["form-section reveal-box",{revealed:_.value}]),style:{"animation-delay":"0.3s"}},[e("h2",Ue,l(i(o)("profile.changePassword")),1),e("p",Ie,l(i(o)("profile.passwordDescription")),1),e("div",Ve,[e("div",Ee,[e("label",qe,l(i(o)("profile.currentPassword")),1),g(e("input",{id:"currentPassword","onUpdate:modelValue":s[4]||(s[4]=n=>a.currentPassword=n),type:"password",class:"form-input",placeholder:i(o)("profile.enterCurrentPassword")},null,8,Le),[[y,a.currentPassword]]),r.currentPassword?(c(),d("span",Ae,l(r.currentPassword),1)):m("",!0)]),e("div",Me,[e("label",je,l(i(o)("profile.newPassword")),1),g(e("input",{id:"newPassword","onUpdate:modelValue":s[5]||(s[5]=n=>a.newPassword=n),type:"password",class:"form-input",placeholder:i(o)("profile.enterNewPassword")},null,8,ze),[[y,a.newPassword]]),r.newPassword?(c(),d("span",$e,l(r.newPassword),1)):m("",!0)])])],2),e("div",{class:v(["form-actions reveal-box",{revealed:_.value}]),style:{"animation-delay":"0.4s"}},[e("button",{type:"button",class:"cancel-button",onClick:S},l(i(o)("profile.reset")),1),e("button",{type:"submit",class:"save-button",disabled:k.value},[k.value?(c(),d("span",Xe,l(i(o)("profile.saving")),1)):(c(),d("span",We,l(i(o)("profile.saveChanges")),1))],8,He)],2)],32)])]),e("footer",Ge,[e("div",Je,[e("p",null,"2026 Bido. "+l(i(o)("footer.allRightsReserved")),1)])])]),U(ae,{name:"toast"},{default:te(()=>[u.show?(c(),d("div",{key:0,class:v(["toast",`toast-${u.type}`])},[u.type==="success"?(c(),d("svg",Ke,[...s[10]||(s[10]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(c(),d("svg",Qe,[...s[11]||(s[11]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"},null,-1),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"},null,-1)])])),e("span",null,l(u.message),1)],2)):m("",!0)]),_:1})],64))}}),ss=re(Ye,[["__scopeId","data-v-a8f4b5bb"]]);export{ss as default};

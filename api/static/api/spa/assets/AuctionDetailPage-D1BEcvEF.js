import{d as ve,u as pe,r,c as _,o as he,a as me,b as n,e as o,f as ee,g as e,N as _e,h,i as N,t as l,n as Q,j as fe,w as te,k as I,v as L,F as R,l as O,m as se,p as ye,q as ge,s as we,x as be,_ as ke}from"./index-DaiPwfNo.js";const xe={class:"page-wrapper"},Be={class:"main-content"},Ce={class:"page-container"},qe={key:0,class:"loading-state"},$e={key:1,class:"error-state"},Se={key:2,class:"auction-detail"},Te={class:"auction-grid"},Ae={class:"auction-image-section"},Me={class:"auction-image-container"},Pe=["src","alt"],Ne={key:1,class:"no-image"},Fe={class:"auction-info-section"},je={class:"auction-header"},De={class:"auction-title"},Ve={class:"auction-description"},Qe={class:"price-section"},Ie={class:"price-item"},Le={class:"price-value"},Re={class:"price-item current"},Oe={class:"price-value highlight"},Ue={class:"auction-meta"},Ee={class:"meta-item"},He={class:"meta-value"},Je={class:"meta-item"},ze={class:"meta-value"},Ye={class:"meta-item"},Ge={class:"meta-value"},We={class:"bidding-section"},Ke={key:1,class:"bid-disabled"},Xe={key:2,class:"bid-disabled"},Ze={key:3,class:"bid-disabled winning"},et={class:"bid-input-group"},tt=["min","placeholder","disabled"],st=["disabled"],it={key:0},nt={key:1},ot={key:5,class:"bid-hint"},at={key:0,class:"bid-history"},lt={class:"bid-list"},rt={class:"bid-info"},ut={class:"bidder-name"},ct={class:"bid-time"},dt={class:"bid-amount"},vt={class:"qa-section"},pt={key:0,class:"ask-question-form"},ht=["disabled"],mt=["disabled"],_t={key:0},ft={key:1},yt={key:1,class:"login-prompt"},gt={key:2,class:"qa-loading"},wt={key:3,class:"questions-list"},bt={class:"question-header"},kt={class:"question-author"},xt={class:"question-time"},Bt={class:"question-text"},Ct={key:0,class:"replies-list"},qt={class:"reply-header"},$t={class:"reply-author"},St={class:"reply-time"},Tt={class:"reply-text"},At={key:1,class:"reply-form-container"},Mt=["onClick"],Pt={key:1,class:"reply-form"},Nt=["disabled"],Ft={class:"reply-form-actions"},jt=["onClick","disabled"],Dt={key:0},Vt={key:1},Qt={key:4,class:"no-questions"},f="http://localhost:8000/api",It=ve({__name:"AuctionDetailPage",setup(Lt){const ie=be(),ne=we(),F=pe(),s=r(null),$=r(!0),d=r(null),y=r([]),v=r(null),g=r(!1),w=r(null),U=r("success");let S=null;const b=r([]),j=r(!1),m=r(""),k=r(!1),x=r(null),E=r("success"),T=r(null),p=r(""),B=r(!1),oe=_(()=>{if(!s.value?.owner)return"Unknown";const{first_name:i,last_name:t,email:c}=s.value.owner;return i||t?`${i} ${t}`.trim():c}),A=_(()=>F.user?.id??null),H=_(()=>!s.value||!A.value?!1:s.value.owner.id===A.value),J=_(()=>!A.value||y.value.length===0?!1:y.value[0].user.id===A.value),z=_(()=>s.value?parseFloat(s.value.current_price)+.01:0),Y=_(()=>!v.value||!s.value?!1:v.value>parseFloat(s.value.current_price));function C(i){return"£"+parseFloat(i).toFixed(2)}function G(i){return new Date(i).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}function D(i){const t=new Date(i),a=new Date().getTime()-t.getTime(),u=Math.floor(a/1e3),M=Math.floor(u/60),P=Math.floor(M/60),Z=Math.floor(P/24);return u<60?"just now":M<60?`${M} minute${M>1?"s":""} ago`:P<24?`${P} hour${P>1?"s":""} ago`:`${Z} day${Z>1?"s":""} ago`}function ae(){ne.push({name:"home"})}function V(i,t){w.value=i,U.value=t,setTimeout(()=>{w.value=null},5e3)}async function W(){const i=ie.params.id;if(!i){d.value="No auction ID provided",$.value=!1;return}$.value=!0,d.value=null;try{const t=await fetch(`${f}/auctions/${i}/`,{credentials:"include"});if(!t.ok){t.status===404?d.value="Auction not found":d.value="Failed to load auction details";return}const c=await t.json();s.value=c.item,await K()}catch(t){d.value="Could not connect to the server",console.error(t)}finally{$.value=!1}}async function K(){if(s.value)try{const i=await fetch(`${f}/auctions/${s.value.id}/`,{credentials:"include"});if(i.ok){const t=await i.json(),c=t.item.current_price;s.value&&c!==s.value.current_price&&(s.value.current_price=c,s.value.is_active=t.item.is_active)}}catch(i){console.error("Failed to fetch bids:",i)}}async function le(){if(!(!s.value||!v.value||!Y.value)){g.value=!0,w.value=null;try{const i=await fetch(`${f}/bids/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({item_id:s.value.id,bid_amount:v.value.toFixed(2)})}),t=await i.json();if(!i.ok){V(t.error||"Failed to place bid","error");return}s.value.current_price=t.item.current_price,s.value.is_active=t.item.is_active,y.value.unshift(t.bid),v.value=null,V("Bid placed successfully!","success")}catch(i){V("Could not connect to the server","error"),console.error(i)}finally{g.value=!1}}}function re(){S=setInterval(async()=>{s.value?.is_active?await K():X()},7e3)}function X(){S&&(clearInterval(S),S=null)}function q(i,t){x.value=i,E.value=t,setTimeout(()=>{x.value=null},5e3)}async function ue(){if(s.value){j.value=!0;try{const i=await fetch(`${f}/questions/?item_id=${s.value.id}`,{credentials:"include"});if(i.ok){const t=await i.json();b.value=t.questions}}catch(i){console.error("Failed to fetch questions:",i)}finally{j.value=!1}}}async function ce(){if(!(!s.value||!m.value.trim())){k.value=!0,x.value=null;try{const i=await fetch(`${f}/questions/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({item_id:s.value.id,question_text:m.value.trim()})}),t=await i.json();if(!i.ok){q(t.error||"Failed to post question","error");return}b.value.unshift(t.question),m.value="",q("Question posted successfully!","success")}catch(i){q("Could not connect to the server","error"),console.error(i)}finally{k.value=!1}}}async function de(i){if(p.value.trim()){B.value=!0;try{const t=await fetch(`${f}/questions/${i}/reply/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reply_text:p.value.trim()})}),c=await t.json();if(!t.ok){q(c.error||"Failed to post reply","error");return}const a=b.value.find(u=>u.id===i);a&&a.replies.push(c.reply),p.value="",T.value=null}catch(t){q("Could not connect to the server","error"),console.error(t)}finally{B.value=!1}}}return he(async()=>{await W(),s.value?.is_active&&re(),await ue()}),me(()=>{X()}),(i,t)=>{const c=ge("router-link");return o(),n("div",xe,[ee(_e),e("main",Be,[e("div",Ce,[e("button",{class:"back-btn",onClick:ae},[...t[4]||(t[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m15 18-6-6 6-6"})],-1),N(" Back to Auctions ",-1)])]),$.value?(o(),n("div",qe,[...t[5]||(t[5]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading auction details...",-1)])])):d.value?(o(),n("div",$e,[t[6]||(t[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),e("p",null,l(d.value),1),e("button",{class:"retry-btn",onClick:W},"Try Again")])):s.value?(o(),n("div",Se,[e("div",Te,[e("div",Ae,[e("div",Me,[s.value.image?(o(),n("img",{key:0,src:s.value.image,alt:s.value.title,class:"auction-image"},null,8,Pe)):(o(),n("div",Ne,[...t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),e("circle",{cx:"9",cy:"9",r:"2"}),e("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})],-1),e("span",null,"No Image Available",-1)])]))])]),e("div",Fe,[e("div",je,[e("h1",De,l(s.value.title),1),e("span",{class:Q(["status-badge",s.value.is_active?"active":"ended"])},l(s.value.is_active?"Active":"Ended"),3)]),e("p",Ve,l(s.value.description),1),e("div",Qe,[e("div",Ie,[t[8]||(t[8]=e("span",{class:"price-label"},"Starting Price",-1)),e("span",Le,l(C(s.value.starting_price)),1)]),e("div",Re,[t[9]||(t[9]=e("span",{class:"price-label"},"Current Price",-1)),e("span",Oe,l(C(s.value.current_price)),1)])]),e("div",Ue,[e("div",Ee,[t[10]||(t[10]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e("circle",{cx:"12",cy:"7",r:"4"})],-1)),t[11]||(t[11]=e("span",{class:"meta-label"},"Seller:",-1)),e("span",He,l(oe.value),1)]),e("div",Je,[t[12]||(t[12]=fe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-20472031><rect width="18" height="18" x="3" y="4" rx="2" ry="2" data-v-20472031></rect><line x1="16" x2="16" y1="2" y2="6" data-v-20472031></line><line x1="8" x2="8" y1="2" y2="6" data-v-20472031></line><line x1="3" x2="21" y1="10" y2="10" data-v-20472031></line></svg><span class="meta-label" data-v-20472031>Listed:</span>',2)),e("span",ze,l(G(s.value.created_at)),1)]),e("div",Ye,[t[13]||(t[13]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("polyline",{points:"12 6 12 12 16 14"})],-1)),t[14]||(t[14]=e("span",{class:"meta-label"},"Ends:",-1)),e("span",Ge,l(G(s.value.ends_at)),1)])]),e("div",We,[t[19]||(t[19]=e("h3",null,"Place a Bid",-1)),w.value?(o(),n("div",{key:0,class:Q(["bid-message",U.value])},l(w.value),3)):h("",!0),s.value.is_active?H.value?(o(),n("div",Xe,[...t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})],-1),e("span",null,"You cannot bid on your own auction",-1)])])):J.value?(o(),n("div",Ze,[...t[17]||(t[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})],-1),e("span",null,"You are the highest bidder!",-1)])])):(o(),n("form",{key:4,onSubmit:te(le,["prevent"]),class:"bid-form"},[e("div",et,[t[18]||(t[18]=e("span",{class:"currency-symbol"},"£",-1)),I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),type:"number",step:"0.01",min:z.value,placeholder:`Min: ${C(z.value.toString())}`,class:"bid-input",disabled:g.value,required:""},null,8,tt),[[L,v.value]])]),e("button",{type:"submit",class:"bid-btn",disabled:g.value||!Y.value},[g.value?(o(),n("span",it,"Placing Bid...")):(o(),n("span",nt,"Place Bid"))],8,st)],32)):(o(),n("div",Ke,[...t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})],-1),e("span",null,"This auction has ended",-1)])])),s.value.is_active&&!H.value&&!J.value?(o(),n("p",ot," Enter an amount greater than "+l(C(s.value.current_price)),1)):h("",!0)]),y.value.length>0?(o(),n("div",at,[t[20]||(t[20]=e("h3",null,"Bid History",-1)),e("div",lt,[(o(!0),n(R,null,O(y.value,a=>(o(),n("div",{key:a.id,class:"bid-item"},[e("div",rt,[e("span",ut,l(a.user.first_name)+" "+l(a.user.last_name),1),e("span",ct,l(D(a.timestamp)),1)]),e("span",dt,l(C(a.bid_amount)),1)]))),128))])])):h("",!0)])]),e("div",vt,[t[26]||(t[26]=e("h2",null,"Questions & Answers",-1)),se(F).isAuthenticated?(o(),n("div",pt,[x.value?(o(),n("div",{key:0,class:Q(["qa-message",E.value])},l(x.value),3)):h("",!0),e("form",{onSubmit:te(ce,["prevent"])},[I(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),placeholder:"Ask a question about this item...",class:"question-input",disabled:k.value,rows:"3"},null,8,ht),[[L,m.value]]),e("button",{type:"submit",class:"submit-question-btn",disabled:k.value||!m.value.trim()},[k.value?(o(),n("span",_t,"Posting...")):(o(),n("span",ft,"Ask Question"))],8,mt)],32)])):(o(),n("div",yt,[e("p",null,[t[22]||(t[22]=N("Please ",-1)),ee(c,{to:"/login"},{default:ye(()=>[...t[21]||(t[21]=[N("sign in",-1)])]),_:1}),t[23]||(t[23]=N(" to ask a question.",-1))])])),j.value?(o(),n("div",gt,[...t[24]||(t[24]=[e("div",{class:"loading-spinner-small"},null,-1),e("span",null,"Loading questions...",-1)])])):b.value.length>0?(o(),n("div",wt,[(o(!0),n(R,null,O(b.value,a=>(o(),n("div",{key:a.id,class:"question-item"},[e("div",bt,[e("span",kt,l(a.user.first_name)+" "+l(a.user.last_name),1),e("span",xt,l(D(a.timestamp)),1)]),e("p",Bt,l(a.question_text),1),a.replies.length>0?(o(),n("div",Ct,[(o(!0),n(R,null,O(a.replies,u=>(o(),n("div",{key:u.id,class:"reply-item"},[e("div",qt,[e("span",$t,l(u.user.first_name)+" "+l(u.user.last_name),1),e("span",St,l(D(u.timestamp)),1)]),e("p",Tt,l(u.reply_text),1)]))),128))])):h("",!0),se(F).isAuthenticated?(o(),n("div",At,[T.value!==a.id?(o(),n("button",{key:0,onClick:u=>T.value=a.id,class:"reply-toggle-btn"}," Reply ",8,Mt)):(o(),n("div",Pt,[I(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=u=>p.value=u),placeholder:"Write a reply...",class:"reply-input",disabled:B.value,rows:"2"},null,8,Nt),[[L,p.value]]),e("div",Ft,[e("button",{type:"button",onClick:t[3]||(t[3]=u=>{T.value=null,p.value=""}),class:"cancel-reply-btn"}," Cancel "),e("button",{type:"button",onClick:u=>de(a.id),class:"submit-reply-btn",disabled:B.value||!p.value.trim()},[B.value?(o(),n("span",Dt,"Posting...")):(o(),n("span",Vt,"Post Reply"))],8,jt)])]))])):h("",!0)]))),128))])):(o(),n("div",Qt,[...t[25]||(t[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})],-1),e("p",null,"No questions yet. Be the first to ask!",-1)])]))])])):h("",!0)])])])}}}),Ot=ke(It,[["__scopeId","data-v-20472031"]]);export{Ot as default};

import{d as X,u as K,r as m,b as D,q as Q,c as l,o as n,e as s,f as U,N as Y,n as w,h as V,i as u,t as c,j as g,l as C,v as h,w as Z,T as ee,F as se,_ as ae}from"./index-BVR3-h3M.js";const te={class:"page-wrapper"},re={class:"main-content"},oe={class:"profile-container"},le={class:"avatar-upload-container"},ne=["src"],ie={key:1,class:"avatar-placeholder"},de={class:"avatar-info"},ue={class:"avatar-label"},ce={key:0,class:"error-message"},fe={class:"form-grid"},pe={class:"form-group"},me={key:0,class:"error-message"},we={class:"form-group"},ve={key:0,class:"error-message"},ge={class:"form-group"},he={key:0,class:"error-message"},ye={class:"form-group"},Pe={key:0,class:"error-message"},ke={class:"form-grid"},be={class:"form-group"},_e={key:0,class:"error-message"},Ne={class:"form-group"},xe={key:0,class:"error-message"},Be=["disabled"],De={key:0},Ce={key:1},Oe={key:0,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Fe={key:1,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Se=X({__name:"ProfilePage",setup(Te){const i=K(),y=m(null),P=m(!1),k=m(!1),O=m(null),p=m(""),b=m(null),v=m(!1),t=D({firstName:"",lastName:"",email:"",dateOfBirth:"",currentPassword:"",newPassword:""}),r=D({firstName:"",lastName:"",email:"",dateOfBirth:"",image:"",currentPassword:"",newPassword:""}),f=D({show:!1,message:"",type:"success"}),E=()=>y.value?.click(),I=a=>{const e=a.target;e.files&&e.files[0]&&F(e.files[0])},q=a=>{a.preventDefault(),a.stopPropagation(),P.value=!0},L=a=>{a.preventDefault(),a.stopPropagation(),P.value=!1},M=a=>{a.preventDefault(),a.stopPropagation()},R=a=>{a.preventDefault(),a.stopPropagation(),P.value=!1,a.dataTransfer?.files&&a.dataTransfer.files[0]&&F(a.dataTransfer.files[0])},F=a=>{if(r.image="",!a.type.startsWith("image/")){r.image="Please select an image file";return}if(a.size>5*1024*1024){r.image="File size must be less than 5MB";return}O.value=a,A(a)},A=a=>{const e=new FileReader;e.onload=o=>{const d=new Image;d.onload=()=>{const _=document.createElement("canvas"),T=_.getContext("2d");if(!T)return;const N=Math.min(d.width,d.height),J=(d.width-N)/2,W=(d.height-N)/2;_.width=200,_.height=200,T.drawImage(d,J,W,N,N,0,0,200,200),_.toBlob(B=>{B&&(b.value=B,p.value=URL.createObjectURL(B))},"image/jpeg",.9)},d.src=o.target?.result},e.readAsDataURL(a)},j=()=>{p.value="",O.value=null,b.value=null,y.value&&(y.value.value="")},z=()=>{let a=!0;return r.firstName="",r.lastName="",r.email="",r.dateOfBirth="",r.currentPassword="",r.newPassword="",t.firstName.trim()||(r.firstName="First name is required",a=!1),t.lastName.trim()||(r.lastName="Last name is required",a=!1),/\S+@\S+\.\S+/.test(t.email)||(r.email="Invalid email address",a=!1),t.dateOfBirth&&new Date(t.dateOfBirth)>new Date&&(r.dateOfBirth="Date cannot be in the future",a=!1),(t.currentPassword||t.newPassword)&&(!t.currentPassword||!t.newPassword)&&(t.currentPassword||(r.currentPassword="Current password required"),t.newPassword||(r.newPassword="New password required"),a=!1),t.newPassword&&t.newPassword.length<6&&(r.newPassword="Password must be at least 6 characters",a=!1),a},$=async()=>{if(z()){k.value=!0;try{await H();const a=G("csrftoken"),e=new FormData;e.append("first_name",t.firstName),e.append("last_name",t.lastName),e.append("email",t.email),t.dateOfBirth&&e.append("date_of_birth",t.dateOfBirth),t.currentPassword&&e.append("current_password",t.currentPassword),t.newPassword&&e.append("new_password",t.newPassword),b.value&&e.append("profile_image",b.value,"profile.jpg");const o=await fetch("http://localhost:8000/api/profile/update/",{method:"POST",headers:{"X-CSRFToken":a||""},credentials:"include",body:e});if(o.ok)await i.checkAuth(),x("Profile updated successfully","success"),t.currentPassword="",t.newPassword="";else{const d=await o.json();x(d.error||"Failed to update profile","error")}}catch{x("An error occurred while updating profile","error")}finally{k.value=!1}}},S=async()=>{await i.checkAuth(),i.user&&(t.firstName=i.user.first_name||"",t.lastName=i.user.last_name||"",t.email=i.user.email||"",t.dateOfBirth=i.user.date_of_birth||"",i.user.profile_image&&(p.value=i.user.profile_image))};function G(a){const o=`; ${document.cookie}`.split(`; ${a}=`);return o.length===2&&o.pop()?.split(";").shift()||null}async function H(){try{await fetch("http://localhost:8000/api/auth/csrf/",{credentials:"include"})}catch(a){console.error("Failed to fetch CSRF token:",a)}}function x(a,e="success"){f.message=a,f.type=e,f.show=!0,setTimeout(()=>{f.show=!1},3e3)}return Q(async()=>{await S(),setTimeout(()=>{v.value=!0},50)}),(a,e)=>(n(),l(se,null,[s("div",te,[U(Y),s("main",re,[s("div",oe,[s("div",{class:w(["profile-header reveal-box",{revealed:v.value}])},[...e[6]||(e[6]=[s("h1",{class:"profile-title"},"Profile Settings",-1),s("p",{class:"profile-subtitle"},"Manage your account information",-1)])],2),s("form",{onSubmit:V($,["prevent"]),class:"profile-form"},[s("div",{class:w(["form-section reveal-box",{revealed:v.value}]),style:{"animation-delay":"0.1s"}},[e[10]||(e[10]=s("h2",{class:"section-title"},"Profile Picture",-1)),s("div",le,[s("div",{class:w(["avatar-preview",{dragging:P.value}]),onClick:E,onDragenter:q,onDragleave:L,onDragover:M,onDrop:R},[s("input",{ref_key:"fileInput",ref:y,type:"file",accept:"image/*",onChange:I,class:"file-input"},null,544),p.value?(n(),l("img",{key:0,src:p.value,alt:"Profile",class:"avatar-image"},null,8,ne)):(n(),l("div",ie,[...e[7]||(e[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),s("circle",{cx:"12",cy:"7",r:"4"})],-1)])])),p.value?(n(),l("button",{key:2,type:"button",class:"remove-button",onClick:V(j,["stop"])},[...e[8]||(e[8]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])):u("",!0)],34),s("div",de,[s("p",ue,c(p.value?"Avatar uploaded":"Upload avatar"),1),e[9]||(e[9]=s("p",{class:"avatar-hint"},"PNG, JPG up to 5MB",-1))]),r.image?(n(),l("span",ce,c(r.image),1)):u("",!0)])],2),s("div",{class:w(["form-section reveal-box",{revealed:v.value}]),style:{"animation-delay":"0.2s"}},[e[15]||(e[15]=s("h2",{class:"section-title"},"Personal Information",-1)),s("div",fe,[s("div",pe,[e[11]||(e[11]=s("label",{for:"firstName",class:"form-label"},[C("First Name "),s("span",{class:"required"},"*")],-1)),g(s("input",{id:"firstName","onUpdate:modelValue":e[0]||(e[0]=o=>t.firstName=o),type:"text",class:"form-input",placeholder:"Enter first name"},null,512),[[h,t.firstName]]),r.firstName?(n(),l("span",me,c(r.firstName),1)):u("",!0)]),s("div",we,[e[12]||(e[12]=s("label",{for:"lastName",class:"form-label"},[C("Last Name "),s("span",{class:"required"},"*")],-1)),g(s("input",{id:"lastName","onUpdate:modelValue":e[1]||(e[1]=o=>t.lastName=o),type:"text",class:"form-input",placeholder:"Enter last name"},null,512),[[h,t.lastName]]),r.lastName?(n(),l("span",ve,c(r.lastName),1)):u("",!0)]),s("div",ge,[e[13]||(e[13]=s("label",{for:"email",class:"form-label"},[C("Email "),s("span",{class:"required"},"*")],-1)),g(s("input",{id:"email","onUpdate:modelValue":e[2]||(e[2]=o=>t.email=o),type:"email",class:"form-input",placeholder:"Enter your email"},null,512),[[h,t.email]]),r.email?(n(),l("span",he,c(r.email),1)):u("",!0)]),s("div",ye,[e[14]||(e[14]=s("label",{for:"dateOfBirth",class:"form-label"},"Date of Birth",-1)),g(s("input",{id:"dateOfBirth","onUpdate:modelValue":e[3]||(e[3]=o=>t.dateOfBirth=o),type:"date",class:"form-input"},null,512),[[h,t.dateOfBirth]]),r.dateOfBirth?(n(),l("span",Pe,c(r.dateOfBirth),1)):u("",!0)])])],2),s("div",{class:w(["form-section reveal-box",{revealed:v.value}]),style:{"animation-delay":"0.3s"}},[e[18]||(e[18]=s("h2",{class:"section-title"},"Change Password",-1)),e[19]||(e[19]=s("p",{class:"section-description"},"Leave blank if you don't want to change your password",-1)),s("div",ke,[s("div",be,[e[16]||(e[16]=s("label",{for:"currentPassword",class:"form-label"},"Current Password",-1)),g(s("input",{id:"currentPassword","onUpdate:modelValue":e[4]||(e[4]=o=>t.currentPassword=o),type:"password",class:"form-input",placeholder:"Enter current password"},null,512),[[h,t.currentPassword]]),r.currentPassword?(n(),l("span",_e,c(r.currentPassword),1)):u("",!0)]),s("div",Ne,[e[17]||(e[17]=s("label",{for:"newPassword",class:"form-label"},"New Password",-1)),g(s("input",{id:"newPassword","onUpdate:modelValue":e[5]||(e[5]=o=>t.newPassword=o),type:"password",class:"form-input",placeholder:"Enter new password"},null,512),[[h,t.newPassword]]),r.newPassword?(n(),l("span",xe,c(r.newPassword),1)):u("",!0)])])],2),s("div",{class:w(["form-actions reveal-box",{revealed:v.value}]),style:{"animation-delay":"0.4s"}},[s("button",{type:"button",class:"cancel-button",onClick:S},"Reset"),s("button",{type:"submit",class:"save-button",disabled:k.value},[k.value?(n(),l("span",Ce,"Saving...")):(n(),l("span",De,"Save Changes"))],8,Be)],2)],32)])])]),U(ee,{name:"toast"},{default:Z(()=>[f.show?(n(),l("div",{key:0,class:w(["toast",`toast-${f.type}`])},[f.type==="success"?(n(),l("svg",Oe,[...e[20]||(e[20]=[s("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):(n(),l("svg",Fe,[...e[21]||(e[21]=[s("circle",{cx:"12",cy:"12",r:"10"},null,-1),s("line",{x1:"12",y1:"8",x2:"12",y2:"12"},null,-1),s("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"},null,-1)])])),s("span",null,c(f.message),1)],2)):u("",!0)]),_:1})],64))}}),Ve=ae(Se,[["__scopeId","data-v-45895e9d"]]);export{Ve as default};
